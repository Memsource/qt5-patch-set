From bd8e1c34279aafda26a01382c1002d997873b3d3 Mon Sep 17 00:00:00 2001
From: "michal.lazo" <michal.lazo@memsource.com>
Date: Fri, 10 Aug 2018 17:26:55 +0200
Subject: [PATCH] QTBUG-69665 Only show the bidi cursor mark if we actually
 have bidirectional text

---
 src/gui/text/qtextengine.cpp | 30 +++++++++++++++++++++---------
 1 file changed, 21 insertions(+), 9 deletions(-)

diff --git a/src/gui/text/qtextengine.cpp b/src/gui/text/qtextengine.cpp
index 5e38311..0c7aad7 100644
--- a/src/gui/text/qtextengine.cpp
+++ b/src/gui/text/qtextengine.cpp
@@ -1036,20 +1036,32 @@ struct QBidiAlgorithm {
             resolveImplicitLevelsForIsolatedRun(runs, i);
         }
     }
+    
+    bool checkForBidi() const
+    {
+        if (baseLevel != 0)
+            return true;
+        for (int i = 0; i < length; ++i) {
+            if (text[i].unicode() >= 0x590) {
+                switch (text[i].direction()) {
+                    case QChar::DirR: case QChar::DirAN:
+                    case QChar::DirLRE: case QChar::DirLRO: case QChar::DirAL:
+                    case QChar::DirRLE: case QChar::DirRLO: case QChar::DirPDF:
+                    case QChar::DirLRI: case QChar::DirRLI: case QChar::DirFSI: case QChar::DirPDI:
+                        return true;
+                    default:
+                        break;
+                }
+            }
+        }
+        return false;
+    }
 
     bool process()
     {
         memset(analysis, 0, length * sizeof(QScriptAnalysis));
 
-        bool hasBidi = (baseLevel != 0);
-        if (!hasBidi) {
-            for (int i = 0; i < length; ++i) {
-                if (text[i].unicode() >= 0x590) {
-                    hasBidi = true;
-                    break;
-                }
-            }
-        }
+        bool hasBidi = checkForBidi();
 
         if (!hasBidi)
             return false;
-- 
2.9.2.windows.1

