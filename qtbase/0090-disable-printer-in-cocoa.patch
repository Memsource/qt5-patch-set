From 05b8f528dfe19b71521cae453d5d0d815de5ff93 Mon Sep 17 00:00:00 2001
From: Michal Lazo <michal.lazo@memsource.com>
Date: Wed, 6 Feb 2019 12:47:00 +0100
Subject: [PATCH] disable printer in cocoa

---
 src/plugins/platforms/cocoa/cocoa.pro                | 2 +-
 src/plugins/platforms/cocoa/qcocoanativeinterface.mm | 2 ++
 src/plugins/platforms/cocoa/qcocoaprintdevice.h      | 2 ++
 src/plugins/platforms/cocoa/qcocoaprintdevice.mm     | 2 ++
 src/plugins/platforms/cocoa/qcocoaprintersupport.h   | 2 ++
 5 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/src/plugins/platforms/cocoa/cocoa.pro b/src/plugins/platforms/cocoa/cocoa.pro
index 8d65cf328f..77ca0e3810 100644
--- a/src/plugins/platforms/cocoa/cocoa.pro
+++ b/src/plugins/platforms/cocoa/cocoa.pro
@@ -122,7 +122,7 @@ qtHaveModule(widgets) {
         HEADERS += qcocoafontdialoghelper.h
     }
 
-    QT += widgets-private printsupport-private
+    QT += widgets-private
 }
 
 OTHER_FILES += cocoa.json
diff --git a/src/plugins/platforms/cocoa/qcocoanativeinterface.mm b/src/plugins/platforms/cocoa/qcocoanativeinterface.mm
index 7979e430ac..8d6648fedc 100644
--- a/src/plugins/platforms/cocoa/qcocoanativeinterface.mm
+++ b/src/plugins/platforms/cocoa/qcocoanativeinterface.mm
@@ -62,8 +62,10 @@
 #ifndef QT_NO_WIDGETS
 #include "qcocoaprintersupport.h"
 #include "qprintengine_mac_p.h"
+#if !defined(QT_NO_PRINTER)
 #include <qpa/qplatformprintersupport.h>
 #endif
+#endif
 
 #include <QtGui/private/qcoregraphics_p.h>
 
diff --git a/src/plugins/platforms/cocoa/qcocoaprintdevice.h b/src/plugins/platforms/cocoa/qcocoaprintdevice.h
index d267343b0e..375f690e5e 100644
--- a/src/plugins/platforms/cocoa/qcocoaprintdevice.h
+++ b/src/plugins/platforms/cocoa/qcocoaprintdevice.h
@@ -51,7 +51,9 @@
 // We mean it.
 //
 
+#ifndef QT_NO_PRINTER
 #include <qpa/qplatformprintdevice.h>
+#endif
 
 #ifndef QT_NO_PRINTER
 
diff --git a/src/plugins/platforms/cocoa/qcocoaprintdevice.mm b/src/plugins/platforms/cocoa/qcocoaprintdevice.mm
index 7605dc9d1a..c2500bf2ca 100644
--- a/src/plugins/platforms/cocoa/qcocoaprintdevice.mm
+++ b/src/plugins/platforms/cocoa/qcocoaprintdevice.mm
@@ -39,10 +39,12 @@
 
 #include "qcocoaprintdevice.h"
 
+#ifndef QT_NO_PRINTER
 #if QT_CONFIG(mimetype)
 #include <QtCore/qmimedatabase.h>
 #endif
 #include <qdebug.h>
+#endif
 
 QT_BEGIN_NAMESPACE
 
diff --git a/src/plugins/platforms/cocoa/qcocoaprintersupport.h b/src/plugins/platforms/cocoa/qcocoaprintersupport.h
index 40a638207a..93b2d5d22c 100644
--- a/src/plugins/platforms/cocoa/qcocoaprintersupport.h
+++ b/src/plugins/platforms/cocoa/qcocoaprintersupport.h
@@ -40,7 +40,9 @@
 #ifndef QCOCOAPRINTERSUPPORT_H
 #define QCOCOAPRINTERSUPPORT_H
 
+#ifndef QT_NO_PRINTER
 #include <qpa/qplatformprintersupport.h>
+#endif
 #ifndef QT_NO_PRINTER
 
 #include "qt_mac_p.h"
-- 
2.18.0.windows.1

